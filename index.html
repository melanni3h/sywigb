<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>sywigb</title>
        
        <style>
            @import url('https://fonts.cdnfonts.com/css/chicago-2');
            
            /* ===== BASE STYLES ===== */
            body {
                margin: 0;
                font-family: 'Chicago', 'Courier New', monospace;
                background-color: #222;
                height: 100vh;
            }
    
            canvas {
                display: block;
            }
    
            /* ===== DESKTOP LAYOUT ===== */
            .desktop {
                position: relative;
                width: 800px;
                height: 600px;
                margin: 5% auto;
                background-color: #fff;
                border: 2px solid #000;
                box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.5);
                overflow: auto;
                background-image: radial-gradient(#000 1px, transparent 0);
                background-size: 4px 4px;
                display: block;
            }
    
            /* ===== MOBILE LAYOUT ===== */
            .mobile {
                display: none;
                background-color: #fff;
                background-image: radial-gradient(#000 1px, transparent 0);
                background-size: 4px 4px;
                min-height: 100vh;
            }
    
            /* ===== MENU BARS ===== */
            .menu-bar {
                position: relative;
                top: 0;
                left: 0;
                right: 0;
                background-color: #fff;
                border-bottom: 2px solid #000;
                height: 20px;
                display: flex;
                align-items: center;
                padding: 0 10px;
                z-index: 100;
            }
    
            .mobile-menu-bar {
                background-color: #fff;
                border-bottom: 2px solid #000;
                height: 30px;
                display: flex;
                align-items: center;
                padding: 0 10px;
                z-index: 110;
                position: sticky;
                top: 0;
            }
    
            .menu-item {
                margin-right: 15px;
                cursor: pointer;
            }
    
            #mobile-logo-icon {
                width: 18px;
                height: 15px;
                margin-right: 10px;
                display: inline-block;
            }
    
            /* ===== DESKTOP WINDOWS ===== */
            .window {
                position: absolute;
                width: 400px;
                background-color: #fff;
                border: 2px solid #000;
                display: flex;
                flex-direction: column;
                box-shadow: 3px 3px 0 rgba(0,0,0,0.4);
                z-index: 10;
            }
    
            .title-bar {
                background-color: #fff;
                border-bottom: 2px solid #000;
                height: 20px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                cursor: grab;
                position: relative;
                font-family: 'Chicago', sans-serif;
            }
    
            .title-bar:active {
                cursor: grabbing;
            }
    
            .title-bar .title {
                font-size: 12px;
                text-align: center;
                flex: 1;
                margin-top: 2px;
            }
    
            .title-bar:after {
                content: '';
                position: absolute;
                left: 0;
                right: 0;
                bottom: 0;
                height: 2px;
                background: repeating-linear-gradient(
                    to right,
                    #000,
                    #000 2px,
                    transparent 2px,
                    transparent 4px
                );
            }
    
            .close-box {
                width: 12px;
                height: 12px;
                border: 2px solid #000;
                margin-left: 5px;
                cursor: pointer;
                position: relative;
            }
    
            .close-box::before {
                content: '';
                position: absolute;
                width: 7px;
                height: 7px;
                border: 2px solid #000;
                top: 0.5px;
                left: 0.5px;
            }
    
            .resize-box {
                width: 12px;
                height: 12px;
                border: 2px solid #000;
                margin-right: 5px;
                cursor: nwse-resize;
            }
    
            .content {
                flex: 1;
                padding: 10px;
                overflow: auto;
                background-color: #fff;
                position: relative;
                font-family: 'Courier New', monospace;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                height: 250px;
            }
    
            /* ===== MOBILE WINDOWS ===== */
            .mobile-window {
                width: 95%;
                margin: 0 auto 15px auto;
                background-color: #fff;
                border: 2px solid #000;
                box-shadow: 3px 3px 0 rgba(0,0,0,0.4);
                border-radius: 2px;
                z-index: 100;
                overflow: visible;
            }
    
            .mobile-content-area {
                height: calc(100vh - 30px);
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
                position: relative;
                padding-right: 20px;
            }
    
            .mobile-title-bar {
                background-color: #fff;
                border-bottom: 2px solid #000;
                height: 30px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0 10px;
                position: relative;
            }
    
            .mobile-title-bar:after {
                content: '';
                position: absolute;
                left: 0;
                right: 0;
                bottom: 0;
                height: 2px;
                background: repeating-linear-gradient(
                    to right,
                    #000,
                    #000 2px,
                    transparent 2px,
                    transparent 4px
                );
                z-index: 5;
            }
    
            .mobile-title-bar .title {
                font-size: 14px;
                text-align: center;
                flex: 1;
                margin-top: 2px;
            }
    
            .mobile-close-box {
                width: 16px;
                height: 16px;
                border: 2px solid #000;
                position: relative;
            }
    
            .mobile-close-box::before {
                content: '';
                position: absolute;
                width: 10px;
                height: 10px;
                border: 2px solid #000;
                top: 1px;
                left: 1px;
            }
    
            .mobile-content {
                padding: 15px 35px 15px 15px;
                overflow: auto;
                background-color: #fff;
                transition: max-height 0.3s ease-out;
            }
    
            .mobile-collapsed {
                max-height: 0 !important;
                padding: 0 !important;
                overflow: hidden !important;
                border-top: none !important;
                margin: 0 !important;
            }
    
            .mobile-content.mobile-collapsed {
                border-bottom: none !important;
                border-top: none !important;
            }
    
            /* ===== DESKTOP ICONS ===== */
            .desktop-icon {
                position: absolute;
                display: flex;
                flex-direction: column;
                align-items: center;
                width: 64px;
                cursor: pointer;
            }
    
            .icon-image {
                width: 32px;
                height: 32px;
                border: 2px solid #000;
                background-color: #fff;
                margin-bottom: 5px;
            }
    
            .icon-label {
                text-align: center;
                font-size: 10px;
                color: #000;
                background-color: #fff;
                padding: 2px;
            }
    
            /* ===== BUTTONS ===== */
            button.btn {
                font-family: 'Chicago', 'Courier New', monospace;
                background-color: #fff;
                color: #000;
                border: 2px solid #000;
                border-radius: 3px;
                padding: 3px 8px;
                cursor: pointer;
                font-size: 12px;
                box-shadow: 2px 2px 0 rgba(0,0,0,0.5);
                margin-top: 10px;
            }
    
            button.btn:active {
                box-shadow: none;
                transform: translate(1px, 1px);
            }
    
            .mobile-btn {
                font-family: 'Chicago', 'Courier New', monospace;
                background-color: #fff;
                color: #000;
                border: 2px solid #000;
                border-radius: 3px;
                padding: 8px 16px;
                cursor: pointer;
                font-size: 14px;
                box-shadow: 2px 2px 0 rgba(0,0,0,0.5);
                margin: 10px auto;
                display: block;
            }
    
            .mobile-btn:active {
                box-shadow: none;
                transform: translate(1px, 1px);
            }
    
            /* ===== DESKTOP SLIDERS ===== */
            .slider-container {
                position: relative;
                display: flex;
                flex-direction: column;
                align-items: center;
                margin: 0 10px;
            }
    
            .mac-slider {
                width: 24px;
                height: 110px;
                position: relative;
                background-color: #fff;
                border: 2px solid #000;
                border-radius: 2px;
            }
    
            .slider-track {
                position: absolute;
                width: 10px;
                height: 90px;
                background-color: #fff;
                border: 2px solid #000;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }
    
            .slider-thumb {
                position: absolute;
                width: 20px;
                height: 14px;
                background-color: #fff;
                border: 2px solid #000;
                border-radius: 2px;
                left: 50%;
                transform: translateX(-50%);
                cursor: ns-resize;
            }
    
            .slider-thumb::after {
                content: '';
                position: absolute;
                width: 10px;
                height: 2px;
                background-color: #000;
                top: 6px;
                left: 4px;
            }
    
            .slider-label {
                font-size: 10px;
                text-align: center;
                margin-top: 5px;
                width: 100%;
                font-weight: bold;
            }
    
            #volume-sliders {
                display: flex;
                justify-content: space-around;
                width: 100%;
                margin-bottom: 20px;
            }
    
            /* ===== MOBILE SLIDERS ===== */
            .mobile-slider-container {
                display: flex;
                align-items: center;
                width: 95%;
                margin: 0 auto 15px auto;
            }
    
            .mobile-slider-label {
                font-size: 12px;
                font-weight: bold;
                width: 60px;
                flex-shrink: 0;
            }
    
            .horizontal-slider {
                flex: 1;
                height: 28px;
                position: relative;
                margin: 0 10px;
            }
    
            .horizontal-track {
                position: absolute;
                width: 100%;
                height: 10px;
                background-color: #fff;
                border: 2px solid #000;
                top: 50%;
                transform: translateY(-50%);
            }
    
            .horizontal-thumb {
                position: absolute;
                width: 24px;
                height: 24px;
                background-color: #fff;
                border: 2px solid #000;
                border-radius: 50%;
                top: 50%;
                transform: translate(-50%, -50%);
                cursor: pointer;
            }
    
            /* ===== MENUS ===== */
            .mac-menu-bar {
                width: 100%;
                border-bottom: 2px solid black;
                margin-bottom: 10px;
            }
    
            .mac-menu {
                width: 100%;
                position: relative;
                display: inline-block;
                font-family: 'Courier New', Courier, monospace;
            }
    
            .mac-menu-title {
                display: block;
                padding: 2px 5px;
                border: 2px solid black;
                background: white;
                font-size: 10px;
                cursor: pointer;
                text-align: left;
            }
    
            .mac-menu-dropdown {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                width: 100%;
                border: 2px solid black;
                background: white;
                box-shadow: 2px 2px 0 rgba(0,0,0,0.5);
                z-index: 1000;
                max-height: 200px;
                overflow-y: auto;
            }
    
            .mac-menu-dropdown ul {
                list-style: none;
                padding: 0;
                margin: 0;
            }
    
            .mac-menu-dropdown li {
                font-size: 10px;
                padding: 2px 5px;
                border-bottom: 1px solid black;
            }
    
            .mac-menu-dropdown li:last-child {
                border-bottom: none;
            }
    
            .mac-menu-dropdown li.selected {
                background-color: black;
                color: white;
            }
    
            .mac-menu-dropdown li.disabled {
                color: #888;
                cursor: not-allowed;
            }
    
            .mac-menu-dropdown li:not(.disabled):hover {
                background-color: #000;
                color: white;
            }
    
            .mac-menu:hover .mac-menu-dropdown {
                display: block;
            }
    
            /* ===== MOBILE SONG MENU ===== */
            .mobile-song-menu {
                position: relative;
                width: 100%;
                margin: 0;
                font-family: 'Chicago', 'Courier New', monospace;
            }
    
            .mobile-song-button {
                width: 100%;
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 5px 12px;
                background-color: #fff;
                border: none;
                border-bottom: 2px solid #000;
                font-size: 12px;
                text-align: left;
                cursor: pointer;
                box-sizing: border-box;
            }
    
            .mobile-song-button .arrow {
                transition: transform 0.2s ease;
            }
    
            .mobile-song-dropdown {
                position: absolute;
                top: 100%;
                left: 0;
                width: 100%;
                max-height: 0;
                overflow: hidden;
                background-color: #fff;
                border: none;
                border-bottom: 2px solid #000;
                z-index: 1020;
                transition: max-height 0.3s ease-out;
                box-sizing: border-box;
            }
    
            .mobile-song-dropdown.open {
                max-height: 250px;
                overflow-y: auto;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            }
    
            .song-item {
                padding: 10px 12px;
                border-bottom: 1px solid #ddd;
                font-size: 12px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                width: 100%;
                box-sizing: border-box;
            }
    
            .mobile-song-dropdown .song-item:last-child {
                border-bottom: none;
            }
    
            .mobile-song-dropdown .song-item:active {
                background-color: #000;
                color: #fff;
            }
    
            .mobile-song-dropdown .song-item.disabled {
                color: #888;
                cursor: not-allowed;
            }
    
            .mobile-song-dropdown .title {
                font-weight: normal;
            }
    
            /* ===== ORB GAME STYLES ===== */
            .game-container {
                display: flex;
                flex-direction: column;
                align-items: center;
                width: 100%;
                height: 100%;
                box-sizing: border-box;
            }
    
            .game-screen {
                width: 240px;
                height: 360px;
                margin-bottom: 20px;
                position: relative;
                overflow: hidden;
                background-color: #fff;
                border: 2px solid #000;
                border-radius: 50%;
            }
    
            .mobile-game-screen {
                width: 200px;
                height: 200px;
                margin: 10px auto;
                position: relative;
                overflow: hidden;
                background-color: #fff;
                border: 2px solid #000;
                border-radius: 50%;
            }
    
            .dialogue-box {
                width: 260px;
                height: 60px;
                border: 2px solid #000;
                background-color: #fff;
                padding: 5px;
                font-size: 10px;
                font-family: 'Courier New', monospace;
                overflow: hidden;
            }
    
            .mobile-dialogue-box {
                width: 95%;
                margin: 10px auto;
                min-height: 60px;
                border: 2px solid #000;
                background-color: #fff;
                padding: 8px;
                font-size: 12px;
                font-family: 'Courier New', monospace;
                box-sizing: border-box;
            }
    
            .question-input {
                width: 260px;
                font-family: 'Courier New', monospace;
                font-size: 10px;
                border: 2px solid #000;
                padding: 5px;
                margin-top: 5px;
            }
    
            .mobile-question-input {
                width: 95%;
                margin: 10px auto;
                font-family: 'Courier New', monospace;
                font-size: 12px;
                border: 2px solid #000;
                padding: 8px;
                box-sizing: border-box;
            }
    
            .ask-button {
                margin-top: 5px;
                width: 60px;
            }
    
            /* ===== GAME CONTAINER ADJUSTMENTS ===== */
            .mobile-window .game-container {
                display: flex;
                flex-direction: column;
                align-items: center;
                width: 95%;
                margin: 0 auto;
                box-sizing: border-box;
            }
    
            /* ===== LOADING INDICATORS ===== */
            .loading-indicator {
                font-size: 10px;
                margin-top: 5px;
                text-align: center;
            }
    
            /* ===== LOG TABLES ===== */
            .mobile-log-table {
                width: 95%;
                margin: 0 auto;
                font-size: 12px;
                border-collapse: collapse;
            }
    
            .mobile-log-table th, .mobile-log-table td {
                text-align: left;
                padding: 6px;
                border-bottom: 1px solid #000;
            }
    
            .mobile-log-table th {
                font-weight: bold;
            }
    
            /* ===== MOBILE SCROLLBAR ===== */
            .mobile-custom-scrollbar {
                position: fixed;
                right: 0;
                top: 30px;
                bottom: 0;
                width: 20px;
                background-color: #fff;
                border-left: 2px solid #000;
                display: flex;
                flex-direction: column;
                z-index: 1000;
            }
    
            .mobile-scroll-arrow {
                height: 20px;
                display: flex;
                justify-content: center;
                align-items: center;
                background-color: #fff;
                border-bottom: 2px solid #000;
                cursor: pointer;
                user-select: none;
            }
    
            .mobile-scroll-track {
                flex: 1;
                position: relative;
            }
    
            .mobile-scroll-thumb {
                position: absolute;
                width: 16px;
                height: 40px;
                left: 50%;
                transform: translateX(-50%);
                background-color: #fff;
                border: 2px solid #000;
                cursor: pointer;
            }
    
            /* ===== PASSWORD OVERLAY ===== */
            .password-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: #222;
                background-image: radial-gradient(#000 1px, transparent 0);
                background-size: 4px 4px;
                z-index: 10000;
                display: flex;
                justify-content: center;
                align-items: center;
            }
    
            .password-window {
                width: 320px;
                background-color: #fff;
                border: 2px solid #000;
                display: flex;
                flex-direction: column;
                box-shadow: 3px 3px 0 rgba(0,0,0,0.4);
                font-family: 'Chicago', 'Courier New', monospace;
            }
    
            .password-title-bar {
                background-color: #fff;
                border-bottom: 2px solid #000;
                height: 20px;
                display: flex;
                justify-content: center;
                align-items: center;
                position: relative;
            }
    
            .password-title-bar:after {
                content: '';
                position: absolute;
                left: 0;
                right: 0;
                bottom: 0;
                height: 2px;
                background: repeating-linear-gradient(
                    to right,
                    #000,
                    #000 2px,
                    transparent 2px,
                    transparent 4px
                );
            }
    
            .password-title {
                font-size: 12px;
                text-align: center;
                margin-top: 2px;
            }
    
            .password-content {
                padding: 20px;
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
    
            .password-message {
                font-size: 12px;
                text-align: center;
                font-family: 'Courier New', monospace;
            }
    
            .password-input {
                width: 200px;
                font-family: 'Courier New', monospace;
                font-size: 12px;
                border: 2px solid #000;
                padding: 5px;
                text-align: center;
            }
    
            .password-input:focus {
                outline: none;
                background-color: #f0f0f0;
            }
    
            .password-btn {
                font-family: 'Chicago', 'Courier New', monospace;
                background-color: #fff;
                color: #000;
                border: 2px solid #000;
                border-radius: 3px;
                padding: 5px 15px;
                cursor: pointer;
                font-size: 12px;
                box-shadow: 2px 2px 0 rgba(0,0,0,0.5);
            }
    
            .password-btn:active {
                box-shadow: none;
                transform: translate(1px, 1px);
            }
    
            .password-error {
                font-size: 10px;
                color: red;
                text-align: center;
                font-family: 'Courier New', monospace;
            }
    
            /* ===== RESPONSIVE DESIGN ===== */
            @media (max-width: 800px) {
                .desktop {
                    display: none;
                }
                
                .mobile {
                    display: block;
                }
    
                .password-window {
                    width: 90%;
                    max-width: 300px;
                }
                
                .password-input {
                    width: 180px;
                }
            }
    
            /* ===== LEGACY COMPONENTS (Remove if unused) ===== */
            #mixer {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                width: 100%;
                height: 100%;
                position: relative;
            }
    
            .mixer-container {
                display: flex;
                flex-direction: column;
                align-items: center;
                width: 100%;
                height: 100%;
                padding: 10px;
                box-sizing: border-box;
            }
    
            .mixer-title {
                font-size: 12px;
                text-align: center;
                width: 95%;
                border-top: 2px solid #000;
                border-bottom: 2px solid #000;
                padding: 4px 0;
                margin-bottom: 20px;
                font-weight: bold;
            }
    
            .volume-sliders {
                display: flex;
                justify-content: space-around;
                width: 100%;
                height: 150px;
                margin-bottom: 20px;
            }
        </style>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/addons/p5.sound.min.js"></script>
    </head>
    <body>
        <!-- ===== PASSWORD OVERLAY (Currently Disabled) ===== -->
        <!-- 
        <div id="password-overlay" class="password-overlay">
            <div class="password-window">
                <div class="password-title-bar">
                    <span class="password-title">System Access Required</span>
                </div>
                <div class="password-content">
                    <div class="password-message">Enter password to access system:</div>
                    <input type="password" id="password-input" class="password-input" placeholder="Password...">
                    <button class="password-btn" id="password-submit">ENTER</button>
                    <div class="password-error" id="password-error" style="display: none;">Access Denied. Try Again.</div>
                </div>
            </div>
        </div> 
        -->
    
        <!-- ===== DESKTOP VERSION ===== -->
        <div class="desktop">
            <!-- Desktop Menu Bar -->
            <div class="menu-bar">
                <span class="menu-item" id="logo-icon"></span>
            </div>
            
            <!-- Desktop Icons -->
            <div class="desktop-icon" style="top: 40px; right: 50px;">
                <div class="icon-image" id="mixer-icon"></div>
                <div class="icon-label">Mixer</div>
            </div>
            
            <div class="desktop-icon" style="top: 120px; right: 50px;">
                <div class="icon-image" id="orb-icon"></div>
                <div class="icon-label">Orb</div>
            </div>
            
            <div class="desktop-icon" style="top: 200px; right: 50px;">
                <div class="icon-image" id="log-book-icon"></div>
                <div class="icon-label">User Log</div>
            </div>
            
            <div class="desktop-icon" style="top: 280px; right: 50px;">
                <div class="icon-image" id="image-icon"></div>
                <div class="icon-label">0001</div>
            </div>
            
            <!-- Desktop Windows -->
            <!-- Audio Mixer Window -->
            <div class="window" id="window1" style="top: 50px; left: 100px; height: 300px;">
                <div class="title-bar" id="title-bar1">
                    <div class="close-box"></div>
                    <span class="title">Audio Mixer</span>
                </div>
                <div class="mac-menu-bar">
                    <div class="mac-menu">
                        <div class="mac-menu-title" id="current-track">Track 3: CHILD</div>
                        <div class="mac-menu-dropdown">
                            <ul>
                                <li data-track-id="track1">Track 1: MADRE</li>
                                <li data-track-id="track2">Track 2: PUSH</li>
                                <li data-track-id="track3" class="selected">Track 3: CHILD</li>
                                <li data-track="Track 4" class="disabled">Track 4</li>
                                <li data-track="Track 5" class="disabled">Track 5</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="content">
                    <div id="volume-sliders"></div>
                    <button class="btn" id="play-button">PLAY</button>
                    <div class="loading-indicator" id="loading-status">Loading audio files...</div>
                </div>
            </div>
            
            <!-- Magic Orb Window -->
            <div class="window" id="window2" style="top: 100px; left: 300px; display: none; width: 300px; height: 420px;">
                <div class="title-bar" id="title-bar2">
                    <div class="close-box"></div>
                    <span class="title">Orb</span>
                </div>
                <div class="content">
                    <div class="game-container">
                        <div class="game-screen" id="orb-canvas-container"></div>
                        <div class="dialogue-box" id="dialogue-box"></div>
                        <input type="text" class="question-input" id="question-input" placeholder="Ask your question...">
                        <button class="btn ask-button" id="ask-button">ASK</button>
                    </div>
                </div>
            </div>
            
            <!-- User Log Window -->
            <div class="window" id="window3" style="top: 250px; left: 200px; display: none; width: 400px; height: 200px;">
                <div class="title-bar" id="title-bar3">
                    <div class="close-box"></div>
                    <span class="title">User Log</span>
                </div>
                <div class="content" id="log-book-content"></div>
            </div>
            
            <!-- Image Gallery Window -->
            <div class="window" id="window4" style="top: 150px; left: 250px; display: none; width: 450px; height: 350px;">
                <div class="title-bar" id="title-bar4">
                    <div class="close-box"></div>
                    <span class="title">0001</span>
                </div>
                <div class="content" id="image-gallery-content" style="display: flex; justify-content: center; align-items: center; padding: 20px;">
                    <img src="assets/img/83734522.png" alt="Gallery Image" style="max-width: 100%; max-height: 100%; object-fit: contain; border: 2px solid #000;">
                </div>
            </div>
        </div>
        
        <!-- ===== MOBILE VERSION ===== -->
        <div class="mobile">
            <!-- Mobile Menu Bar -->
            <div class="mobile-menu-bar">
                <span class="menu-item" id="mobile-logo-icon"></span>
            </div>        
            
            <!-- Mobile Content Area -->
            <div class="mobile-content-area" id="mobile-content-area">
                <!-- Audio Mixer Window (Mobile) -->
                <div class="mobile-window" id="mobile-window1">
                    <div class="mobile-title-bar">
                        <div class="mobile-close-box"></div>
                        <span class="title">Audio Mixer</span>
                    </div>
                    <div class="mobile-content" id="mobile-content1">
                        <div class="mac-menu-bar"></div>
                        <div id="mobile-volume-sliders"></div>
                        <button class="mobile-btn" id="mobile-play-button">PLAY</button>
                        <div class="loading-indicator" id="mobile-loading-status">
                            Loading audio files...<br> 
                            <div style="color: red; font-size: 9px; margin-top: 3px;">Take mobile device OFF SILENT</div>
                        </div>
                    </div>
                </div>
                
                <!-- Magic Orb Window (Mobile) -->
                <div class="mobile-window" id="mobile-window2">
                    <div class="mobile-title-bar">
                        <div class="mobile-close-box"></div>
                        <span class="title">Orb</span>
                    </div>
                    <div class="mobile-content" id="mobile-content2">
                        <div class="game-container">
                            <div class="mobile-game-screen" id="mobile-orb-canvas-container"></div>
                            <div class="mobile-dialogue-box" id="mobile-dialogue-box"></div>
                            <input type="text" class="mobile-question-input" id="mobile-question-input" placeholder="Ask your question...">
                            <button class="mobile-btn" id="mobile-ask-button">ASK</button>
                        </div>
                    </div>
                </div>
                
                <!-- User Log Window (Mobile) -->
                <div class="mobile-window" id="mobile-window3">
                    <div class="mobile-title-bar">
                        <div class="mobile-close-box"></div>
                        <span class="title">User Log</span>
                    </div>
                    <div class="mobile-content" id="mobile-content3">
                        <div id="mobile-log-book-content"></div>
                    </div>
                </div>
    
                <!-- Image Gallery Window (Mobile) -->
                <div class="mobile-window" id="mobile-window4">
                    <div class="mobile-title-bar">
                        <div class="mobile-close-box"></div>
                        <span class="title">0001</span>
                    </div>
                    <div class="mobile-content" id="mobile-content4">
                        <div style="display: flex; justify-content: center; align-items: center; min-height: 200px;">
                            <img src="assets/img/83734522.png" alt="Gallery Image" style="max-width: 90%; max-height: 300px; object-fit: contain; border: 2px solid #000;">
                        </div>
                    </div>
                </div>
            </div>
    
            <!-- Mobile Custom Scrollbar -->
            <div class="mobile-custom-scrollbar">
                <div class="mobile-scroll-arrow" id="mobile-scroll-up">▲</div>
                <div class="mobile-scroll-track">
                    <div class="mobile-scroll-thumb" id="mobile-scroll-thumb"></div>
                </div>
                <div class="mobile-scroll-arrow" id="mobile-scroll-down">▼</div>
            </div>
        </div>


        <script>
            document.addEventListener('DOMContentLoaded', function() {
                
                // ===== CONFIGURATION =====
                const TRACK_CONFIGS = {
                    track1: {
                        files: [
                            'assets/track1/DRUMS.mp3',
                            'assets/track1/BASS.mp3',
                            'assets/track1/GTRS.mp3',
                            'assets/track1/KEYS.mp3',
                            'assets/track1/VOX.mp3',
                            'assets/track1/BVOX.mp3',
                            'assets/track1/ORCH.mp3'
                        ]
                    },
                    track2: {
                        files: [
                            'assets/track2/DRUMS.mp3',
                            'assets/track2/BASS.mp3',
                            'assets/track2/GTRS.mp3',
                            'assets/track2/KEYS.mp3',
                            'assets/track2/VOX.mp3',
                            'assets/track2/BVOX.mp3',
                            'assets/track2/ORCH.mp3'
                        ]
                    },
                    track3: {  
                        files: [
                            'assets/track3/DRUMS.mp3',
                            'assets/track3/BASS.mp3',
                            'assets/track3/GTRS.mp3',
                            'assets/track3/KEYS.mp3',
                            'assets/track3/VOX.mp3',
                            'assets/track3/BVOX.mp3',
                            'assets/track3/ORCH.mp3'
                        ]
                    }
                };
        
                let currentTrackId = 'track3';
        
                // ===== MAIN INITIALIZATION =====
                const isMobile = window.innerWidth <= 800;
                
                // Show appropriate interface
                document.querySelector('.desktop').style.display = isMobile ? 'none' : 'block';
                document.querySelector('.mobile').style.display = isMobile ? 'block' : 'none';
        
                // Initialize based on device type
                if (!isMobile) {
                    initDesktop();
                } else {
                    initMobile();
                }
        
                // ===== RESPONSIVE HANDLING =====
                setupResponsiveHandler();
        
                // ===== INITIALIZATION FUNCTIONS =====
                function initDesktop() {
                    initDesktopIcons();
                    initDesktopAudioMixer();
                    initDesktopOrb();
                    initDesktopUserLog();
                    setupDesktopWindows();
                }
        
                function initMobile() {
                    initMobileLogo();
                    initMobileAudioMixer();
                    initMobileSongMenu();
                    initMobileOrb();
                    initMobileUserLog();
                    setupMobileWindows();
                    fixMobileWindowCollapse();
                    setupCustomScrollbar();
                }
        
                function setupResponsiveHandler() {
                    let lastViewMode = window.innerWidth <= 800 ? 'mobile' : 'desktop';
                    let resizeTimeout;
                
                    window.addEventListener('resize', function() {
                        // Clear any pending resize checks
                        clearTimeout(resizeTimeout);
                        
                        // Wait for resize to finish before checking
                        resizeTimeout = setTimeout(function() {
                            const currentViewMode = window.innerWidth <= 800 ? 'mobile' : 'desktop';
                            
                            // Only reload if view mode actually changed
                            if (currentViewMode !== lastViewMode) {
                                console.log(`View mode changed from ${lastViewMode} to ${currentViewMode}`);
                                
                                // Update display
                                if (currentViewMode === 'mobile') {
                                    document.querySelector('.desktop').style.display = 'none';
                                    document.querySelector('.mobile').style.display = 'block';
                                } else {
                                    document.querySelector('.desktop').style.display = 'block';
                                    document.querySelector('.mobile').style.display = 'none';
                                }
                                
                                lastViewMode = currentViewMode;
                                
                                // Reload for proper reinitialization
                                setTimeout(() => window.location.reload(), 300);
                            }
                        }, 250); // Wait 250ms after resize stops
                    });
                }
        
                // ===== DESKTOP FUNCTIONS =====
                
                function initDesktopIcons() {
                    createLogoIcon();
                    createMixerIcon();
                    createOrbIcon();
                    createLogBookIcon();
                    createGalleryIcon();
                }
        
                function createLogoIcon() {
                    new p5(function(p) {
                        p.setup = function() {
                            let iconCanvas = p.createCanvas(18, 15);
                            iconCanvas.parent('logo-icon');
                            p.background(220);
                            p.strokeWeight(2);
                            p.translate(-6, -6);
                            p.rect(6, 6, 18, 15);
                            p.strokeWeight(3);
                            p.line(9, 9, 9, 18);
                            p.line(13, 9, 13, 18);
                            p.line(13, 18, 21, 18);
                            p.line(17, 9, 17, 14);
                            p.line(17, 14, 21, 14);
                            p.line(21, 14, 21, 9);
                        }
                    });
                }
        
                function createMixerIcon() {
                    new p5(function(p) {
                        p.setup = function() {
                            let iconCanvas = p.createCanvas(32, 32);
                            iconCanvas.parent('mixer-icon');
                            p.background(255);
                            p.stroke(0);
                            p.strokeWeight(2);
                            
                            // Draw mixer background
                            p.fill(255);
                            p.rect(2, 2, 28, 28);
                            
                            // Draw vertical sliders
                            p.strokeWeight(1);
                            for (let i = 0; i < 3; i++) {
                                let x = 8 + i * 8;
                                p.line(x, 8, x, 24); // Slider track
                                p.fill(0);
                                p.rect(x - 2, 14 + p.sin(i) * 4, 4, 4); // Slider thumb
                            }
                        };
                    });
                }
        
                function createOrbIcon() {
                    new p5(function(p) {
                        p.setup = function() {
                            let iconCanvas = p.createCanvas(32, 32);
                            iconCanvas.parent('orb-icon');
                            p.background(255);
                            p.stroke(0);
                            p.strokeWeight(2);
                            
                            // Draw orb outline
                            p.fill(255);
                            p.ellipse(16, 16, 28, 28);
                            
                            // Draw concentric circles
                            p.noFill();
                            for (let i = 0; i < 3; i++) {
                                p.ellipse(16, 16, 20 - i * 5, 20 - i * 5);
                            }
                            
                            // Add highlight
                            p.fill(0);
                            p.ellipse(12, 12, 4, 4);
                        };
                    });
                }
        
                function createLogBookIcon() {
                    new p5(function(p) {
                        p.setup = function() {
                            let iconCanvas = p.createCanvas(32, 32);
                            iconCanvas.parent('log-book-icon');
                            p.background(255);
                            p.stroke(0);
                            p.strokeWeight(2);
                            
                            // Draw book outline and lines
                            p.fill(255);
                            p.rect(2, 2, 28, 24);
                            p.line(2, 10, 30, 10);
                            p.line(2, 18, 30, 18);
                        };
                    });
                }
        
                function createGalleryIcon() {
                    new p5(function(p) {
                        p.setup = function() {
                            let iconCanvas = p.createCanvas(32, 32);
                            iconCanvas.parent('image-icon');
                            p.background(255);
                            p.stroke(0);
                            p.strokeWeight(2);
                            
                            // Draw image frame
                            p.fill(255);
                            p.rect(2, 2, 28, 20);
                            
                            // Draw image content
                            p.fill(200);
                            p.rect(6, 6, 20, 12);
                            
                            // Add sun
                            p.fill(255);
                            p.ellipse(12, 10, 4, 4);
                            
                            // Add mountains
                            p.fill(150);
                            p.triangle(6, 18, 12, 12, 18, 18);
                            p.triangle(14, 18, 20, 14, 26, 18);
                        };
                    });
                }
        
                function initDesktopAudioMixer() {
                    new p5(function(p) {
                        // ===== AUDIO MIXER VARIABLES =====
                        const sounds = [
                            'assets/track3/DRUMS.mp3',
                            'assets/track3/BASS.mp3',
                            'assets/track3/GTRS.mp3',
                            'assets/track3/KEYS.mp3',
                            'assets/track3/VOX.mp3',
                            'assets/track3/BVOX.mp3',
                            'assets/track3/ORCH.mp3'
                        ];
                        
                        const names = ['DRUMS', 'BASS', 'GTRS', 'KEYS', 'VOX', 'BVOX', 'ORCH'];
                        let soundObjects = [];
                        const sliderValues = Array(sounds.length).fill(1.0);
                        let isPlaying = false;
                        let filesLoaded = 0;
                        let loadingFailed = false;
        
                        // ===== AUDIO PRELOADING =====
                        p.preload = function() {
                            p.getAudioContext(); // Ensure audio context is created
                            
                            for (let i = 0; i < sounds.length; i++) {
                                try {
                                    const sound = p.loadSound(sounds[i], 
                                        () => { // Success callback
                                            filesLoaded++;
                                            updateLoadingStatus();
                                        },
                                        (err) => { // Error callback
                                            console.error("Failed to load sound:", err);
                                            loadingFailed = true;
                                            updateLoadingStatus();
                                        }
                                    );
                                    soundObjects.push(sound);
                                } catch (e) {
                                    console.error("Error loading sound:", e);
                                    loadingFailed = true;
                                    soundObjects.push(null);
                                    updateLoadingStatus();
                                }
                            }
                        };
        
                        // ===== SETUP =====
                        p.setup = function() {
                            // Create hidden canvas for p5.js
                            let canvas = p.createCanvas(1, 1);
                            canvas.parent('volume-sliders');
                            canvas.style('display', 'none');
                            
                            createCustomSliders();
                            setupPlayButton();
                            
                            // Set initial volumes
                            soundObjects.forEach((sound, i) => {
                                if (sound && sound.isLoaded()) {
                                    sound.setVolume(sliderValues[i]);
                                }
                            });
                        };
        
                        // ===== HELPER FUNCTIONS =====
                        function updateLoadingStatus() {
                            const loadingStatus = document.getElementById('loading-status');
                            if (loadingFailed) {
                                loadingStatus.textContent = "Failed to load some audio files. Check console for details.";
                                loadingStatus.style.color = "red";
                            } else if (filesLoaded === sounds.length) {
                                loadingStatus.textContent = "All audio files loaded successfully!";
                                setTimeout(() => loadingStatus.style.display = "none", 2000);
                            } else {
                                loadingStatus.textContent = `Loading audio files... (${filesLoaded}/${sounds.length})`;
                            }
                        }
        
                        function createCustomSliders() {
                            const sliderContainer = document.getElementById('volume-sliders');
                            sliderContainer.innerHTML = '';
                            
                            for (let i = 0; i < names.length; i++) {
                                const sliderDiv = createSliderElement(i);
                                sliderContainer.appendChild(sliderDiv);
                            }
                            
                            setupSliderEvents();
                        }
        
                        function createSliderElement(index) {
                            const sliderDiv = document.createElement('div');
                            sliderDiv.className = 'slider-container';
                            
                            const slider = document.createElement('div');
                            slider.className = 'mac-slider';
                            
                            const track = document.createElement('div');
                            track.className = 'slider-track';
                            
                            const thumb = document.createElement('div');
                            thumb.className = 'slider-thumb';
                            thumb.style.top = '10px'; // Middle position
                            thumb.dataset.index = index;
                            
                            const label = document.createElement('div');
                            label.className = 'slider-label';
                            label.textContent = names[index];
                            
                            // Assemble slider
                            slider.appendChild(track);
                            slider.appendChild(thumb);
                            sliderDiv.appendChild(slider);
                            sliderDiv.appendChild(label);
                            
                            return sliderDiv;
                        }
        
                        function setupSliderEvents() {
                            // Mouse down events
                            document.addEventListener('mousedown', (e) => {
                                if (e.target.classList.contains('slider-thumb')) {
                                    e.target.dataset.dragging = true;
                                    e.preventDefault();
                                }
                            });
        
                            // Mouse move events
                            document.addEventListener('mousemove', (e) => {
                                document.querySelectorAll('.slider-thumb[data-dragging="true"]').forEach(thumb => {
                                    updateSliderPosition(thumb, e.clientY);
                                });
                            });
        
                            // Mouse up events
                            document.addEventListener('mouseup', () => {
                                document.querySelectorAll('.slider-thumb').forEach(thumb => {
                                    thumb.dataset.dragging = false;
                                });
                            });
                        }
        
                        function updateSliderPosition(thumbEl, clientY) {
                            const index = parseInt(thumbEl.dataset.index);
                            const sliderEl = thumbEl.closest('.mac-slider');
                            const sliderRect = sliderEl.getBoundingClientRect();
                            const trackEl = sliderEl.querySelector('.slider-track');
                            const trackRect = trackEl.getBoundingClientRect();
                            
                            // Calculate boundaries
                            const thumbHeight = thumbEl.offsetHeight;
                            const halfThumbHeight = thumbHeight / 2;
                            const trackTop = trackRect.top - sliderRect.top;
                            const trackBottom = trackRect.bottom - sliderRect.top;
                            const minY = trackTop + halfThumbHeight;
                            const maxY = trackBottom - halfThumbHeight;
                            
                            // Calculate and constrain position
                            let y = clientY - sliderRect.top;
                            y = Math.max(minY, Math.min(maxY, y));
                            
                            // Calculate value (inverted: 0 at bottom, 1 at top)
                            const value = 1 - ((y - minY) / (maxY - minY));
                            
                            // Update UI and audio
                            thumbEl.style.top = `${y - halfThumbHeight}px`;
                            sliderValues[index] = value;
                            
                            if (soundObjects[index] && soundObjects[index].isLoaded()) {
                                soundObjects[index].setVolume(value);
                            }
                        }
        
                        function setupPlayButton() {
                            const playButton = document.getElementById('play-button');
                            
                            playButton.addEventListener('click', () => {
                                if (filesLoaded !== sounds.length) {
                                    alert("Please wait for all audio files to load.");
                                    return;
                                }
                                
                                togglePlayback();
                            });
                        }
        
                        function togglePlayback() {
                            const playButton = document.getElementById('play-button');
                            
                            if (!isPlaying) {
                                // Start playing
                                soundObjects.forEach(sound => {
                                    if (sound && sound.isLoaded()) {
                                        if (sound.isPaused()) {
                                            sound.play();
                                        } else {
                                            sound.loop();
                                        }
                                    }
                                });
                                playButton.textContent = "STOP";
                                isPlaying = true;
                            } else {
                                // Stop playing
                                soundObjects.forEach(sound => {
                                    if (sound && sound.isPlaying()) {
                                        sound.pause();
                                    }
                                });
                                playButton.textContent = "PLAY";
                                isPlaying = false;
                            }
                        }
        
                        // ===== GLOBAL FUNCTIONS =====
                        window.resetMixer = function() {
                            // Stop all sounds
                            soundObjects.forEach(sound => {
                                if (sound && sound.isLoaded()) {
                                    sound.stop();
                                }
                            });
                            
                            // Reset UI
                            const playButton = document.getElementById('play-button');
                            playButton.textContent = "PLAY";
                            isPlaying = false;
                            
                            // Reset sliders
                            document.querySelectorAll('.slider-thumb').forEach((thumb, index) => {
                                thumb.style.top = '10px';
                                sliderValues[index] = 1.0;
                                if (soundObjects[index] && soundObjects[index].isLoaded()) {
                                    soundObjects[index].setVolume(1.0);
                                }
                            });
                        };
        
                        window.switchToTrackDesktop = function(newTrackId) {
                            const trackConfig = TRACK_CONFIGS[newTrackId];
                            if (!trackConfig) {
                                console.error("Track configuration not found:", newTrackId);
                                return;
                            }
                            
                            console.log("Switching to:", newTrackId);
                            
                            // Stop current playback
                            soundObjects.forEach(sound => {
                                if (sound && sound.isLoaded()) {
                                    sound.stop();
                                }
                            });
                            
                            // Reset UI
                            const playButton = document.getElementById('play-button');
                            playButton.textContent = "PLAY";
                            isPlaying = false;

                            // RESET SLIDERS TO DEFAULT POSITIONS
                            document.querySelectorAll('.slider-thumb').forEach((thumb, index) => {
                                thumb.style.top = '10px'; // Middle position
                                sliderValues[index] = 1.0;
                            });
                            
                            // Show loading
                            const loadingStatus = document.getElementById('loading-status');
                            loadingStatus.style.display = "block";
                            loadingStatus.textContent = "Loading track...";
                            
                            // Reset loading state
                            soundObjects.length = 0;
                            filesLoaded = 0;
                            loadingFailed = false;
                            
                            // Load new track
                            trackConfig.files.forEach((filePath, index) => {
                                try {
                                    const sound = p.loadSound(filePath,
                                        () => { // Success
                                            filesLoaded++;
                                            loadingStatus.textContent = `Loading... (${filesLoaded}/${trackConfig.files.length})`;
                                            sound.setVolume(sliderValues[index]);
                                            
                                            if (filesLoaded === trackConfig.files.length) {
                                                loadingStatus.textContent = "Track loaded!";
                                                setTimeout(() => loadingStatus.style.display = "none", 1500);
                                            }
                                        },
                                        (err) => { // Error
                                            console.error("Failed to load:", filePath, err);
                                            filesLoaded++;
                                            if (filesLoaded === trackConfig.files.length) {
                                                loadingStatus.textContent = "Track loaded (some files missing)";
                                                setTimeout(() => loadingStatus.style.display = "none", 2000);
                                            }
                                        }
                                    );
                                    soundObjects[index] = sound;
                                } catch (e) {
                                    console.error("Error loading sound:", e);
                                    filesLoaded++;
                                }
                            });
                        };
                    });
                }
                function initDesktopOrb() {
                    new p5(function(p) {
                        // ===== ORB VARIABLES =====
                        const CONFIG = {
                            orbSize: 240,
                            pixelSize: 3,
                            typingSpeed: 50
                        };

                        const ANSWERS = [
                            "It is certain.",
                            "Ask again later.",
                            "Don't count on it.",
                            "The stars say yes.",
                            "Very doubtful.",
                            "Without a doubt.",
                            "Yes, definitely.",
                            "Better not tell you now.",
                            "My sources say no.",
                            "Outlook good.",
                            "Reply hazy, try again.",
                            "Signs point to yes."
                        ];

                        let orbX, orbY;
                        let dialogueBox;
                        let animationFrame = 0;
                        let currentText = "";
                        let targetText = "";
                        let textIndex = 0;
                        let lastTypedTime = 0;

                        // ===== SETUP =====
                        p.setup = function() {
                            let canvas = p.createCanvas(240, 238);
                            canvas.parent('orb-canvas-container');
                            
                            orbX = p.width / 2;
                            orbY = p.height / 2;
                            
                            setupDialogueSystem();
                            setDialogue("Ask a question, yes or no, the Orb's wisdom soon will show...");
                        };

                        // ===== DIALOGUE SYSTEM =====
                        function setupDialogueSystem() {
                            dialogueBox = document.getElementById('dialogue-box');
                            
                            document.getElementById('ask-button').addEventListener('click', askQuestion);
                            document.getElementById('question-input').addEventListener('keypress', function(e) {
                                if (e.key === 'Enter') {
                                    askQuestion();
                                }
                            });
                        }

                        function askQuestion() {
                            const questionInput = document.getElementById('question-input');
                            const question = questionInput.value.trim();
                            
                            if (question) {
                                questionInput.value = '';
                                setDialogue("Hmm, let me think...");
                                
                                setTimeout(() => {
                                    const randomAnswer = ANSWERS[Math.floor(Math.random() * ANSWERS.length)];
                                    setDialogue(randomAnswer);
                                }, 1500);
                            }
                        }

                        function setDialogue(text) {
                            targetText = text;
                            textIndex = 0;
                            currentText = "";
                            lastTypedTime = p.millis();
                        }

                        // ===== DRAWING =====
                        p.draw = function() {
                            p.background(0);
                            animationFrame += 0.01;
                            
                            drawOrb();
                            updateTypingEffect();
                        };

                        function drawOrb() {
                            const radius = CONFIG.orbSize / 2;
                            const centerI = Math.floor((CONFIG.orbSize / CONFIG.pixelSize) / 2);
                            const centerJ = Math.floor((CONFIG.orbSize / CONFIG.pixelSize) / 2);
                            
                            // Draw orb border
                            p.noFill();
                            p.stroke(0);
                            p.strokeWeight(2);
                            p.ellipse(orbX, orbY, CONFIG.orbSize, CONFIG.orbSize);
                            
                            // Draw orb pattern
                            p.noStroke();
                            for (let i = 0; i < CONFIG.orbSize / CONFIG.pixelSize; i++) {
                                for (let j = 0; j < CONFIG.orbSize / CONFIG.pixelSize; j++) {
                                    drawOrbPixel(i, j, centerI, centerJ, radius);
                                }
                            }
                        }

                        function drawOrbPixel(i, j, centerI, centerJ, radius) {
                            const dx = (i - centerI);
                            const dy = (j - centerJ);
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            
                            if (distance < (radius / CONFIG.pixelSize) - 1) {
                                const noiseVal = p.noise(i * 0.1, j * 0.1, animationFrame * 0.5);
                                const brightness = noiseVal > 0.5 ? 255 : 0;
                                
                                p.fill(brightness);
                                p.rect(
                                    orbX - radius + i * CONFIG.pixelSize, 
                                    orbY - radius + j * CONFIG.pixelSize, 
                                    CONFIG.pixelSize, 
                                    CONFIG.pixelSize
                                );
                            }
                        }

                        function updateTypingEffect() {
                            if (textIndex < targetText.length && p.millis() > lastTypedTime + CONFIG.typingSpeed) {
                                currentText += targetText.charAt(textIndex);
                                textIndex++;
                                lastTypedTime = p.millis();
                                dialogueBox.textContent = currentText;
                            }
                        }

                        // ===== GLOBAL RESET FUNCTION =====
                        window.resetOrb = function() {
                            const dialogueBox = document.getElementById('dialogue-box');
                            dialogueBox.textContent = "Ask a question, yes or no, the Orb's wisdom soon will show...";
                            document.getElementById('question-input').value = '';
                        };
                    });
                }

                function initDesktopUserLog() {
                    const logEntries = [
                        {
                            date: '2025-07-31',
                            topic: 'WELCOME',
                            message: 'You found us.'
                        }
                    ];
                    
                    const logBookContent = document.getElementById('log-book-content');
                    const table = createLogTable('desktop-log-table');
                    
                    // Add entries to table
                    logEntries.forEach(entry => addLogEntryToTable(table, entry));
                    
                    // Update DOM
                    logBookContent.innerHTML = '';
                    logBookContent.appendChild(table);
                    
                    adjustDesktopLogWindowHeight();
                }

                function setupDesktopWindows() {
                    const windows = document.querySelectorAll('.window');
                    let topZIndex = 10;
                    
                    setupWindowManagement(windows, topZIndex);
                    setupWindowDragging();
                    setupWindowClosing();
                    setupIconDoubleClicks();
                    setupMixerDropdown();
                }

                // ===== WINDOW MANAGEMENT =====
                function setupWindowManagement(windows, topZIndex) {
                    window.bringToFront = function(targetWindow) {
                        windows.forEach(w => {
                            if (w !== targetWindow) {
                                w.style.zIndex = 10;
                            }
                        });
                        targetWindow.style.zIndex = topZIndex + 1;
                        topZIndex++;
                    };
                }

                function setupWindowDragging() {
                    const windowConfigs = [
                        { windowId: 'window1', titleBarId: 'title-bar1' },
                        { windowId: 'window2', titleBarId: 'title-bar2' },
                        { windowId: 'window3', titleBarId: 'title-bar3' },
                        { windowId: 'window4', titleBarId: 'title-bar4' }
                    ];

                    windowConfigs.forEach(config => {
                        setupSingleWindowDrag(config.windowId, config.titleBarId);
                    });
                }

                function setupSingleWindowDrag(windowId, titleBarId) {
                    const windowElement = document.getElementById(windowId);
                    const titleBar = document.getElementById(titleBarId);
                    const desktopElement = document.querySelector('.desktop');
                    let isDragging = false;
                    let offsetX, offsetY;

                    titleBar.addEventListener("mousedown", (e) => {
                        isDragging = true;
                        const windowRect = windowElement.getBoundingClientRect();
                        offsetX = e.clientX - windowRect.left;
                        offsetY = e.clientY - windowRect.top;
                        window.bringToFront(windowElement);
                        e.preventDefault();
                    });

                    document.addEventListener("mousemove", (e) => {
                        if (isDragging) {
                            updateWindowPosition(windowElement, desktopElement, e, offsetX, offsetY);
                        }
                    });

                    document.addEventListener("mouseup", () => {
                        isDragging = false;
                    });
                }

                function updateWindowPosition(windowElement, desktopElement, e, offsetX, offsetY) {
                    const desktopRect = desktopElement.getBoundingClientRect();
                    const windowRect = windowElement.getBoundingClientRect();
                    
                    let newLeft = e.clientX - offsetX;
                    let newTop = e.clientY - offsetY;
                    
                    // Apply boundary constraints
                    const menuBarHeight = 20;
                    newLeft = Math.max(desktopRect.left, Math.min(newLeft, desktopRect.right - windowRect.width));
                    newTop = Math.max(desktopRect.top + menuBarHeight, Math.min(newTop, desktopRect.bottom - windowRect.height));
                    
                    // Update position
                    windowElement.style.left = `${newLeft - desktopRect.left}px`;
                    windowElement.style.top = `${newTop - desktopRect.top}px`;
                }

                function setupWindowClosing() {
                    document.querySelectorAll('.window .close-box').forEach((closeBox, index) => {
                        closeBox.addEventListener('click', () => {
                            const windowElement = document.getElementById(`window${index + 1}`);
                            windowElement.style.display = 'none';
                            
                            // Reset functionality based on window type
                            switch(index) {
                                case 0: // Mixer
                                    if (window.resetMixer) window.resetMixer();
                                    break;
                                case 1: // Orb
                                    if (window.resetOrb) window.resetOrb();
                                    break;
                                // Cases 2 and 3 (log and gallery) don't need reset
                            }
                        });
                    });
                }

                function setupIconDoubleClicks() {
                    const iconWindowMappings = [
                        { iconIndex: 0, windowId: 'window1' }, // Mixer (now index 0)
                        { iconIndex: 1, windowId: 'window2' }, // Orb (now index 1)
                        { iconIndex: 2, windowId: 'window3' }, // Log (now index 2)
                        { iconIndex: 3, windowId: 'window4' }  // Gallery (unchanged)
                    ];

                    iconWindowMappings.forEach(mapping => {
                        const icon = document.querySelectorAll('.desktop-icon')[mapping.iconIndex];
                        const windowElement = document.getElementById(mapping.windowId);
                        
                        icon.addEventListener('dblclick', () => {
                            windowElement.style.display = 'flex';
                            window.bringToFront(windowElement);
                        });
                    });
                }

                function setupMixerDropdown() {
                    const menuItems = document.querySelectorAll('.mac-menu-dropdown li:not(.disabled)');
                    const currentTrackElement = document.getElementById('current-track');

                    menuItems.forEach(item => {
                        item.addEventListener('click', function() {
                            const trackId = this.getAttribute('data-track-id');
                            
                            if (trackId) {
                                updateTrackSelection(menuItems, this, currentTrackElement, trackId);
                            }
                        });
                    });
                }
                
                function updateTrackSelection(menuItems, selectedItem, currentTrackElement, trackId) {
                    menuItems.forEach(el => el.classList.remove('selected'));
                    selectedItem.classList.add('selected');
                    currentTrackElement.textContent = selectedItem.textContent;
                    
                    currentTrackId = trackId;
                    console.log("Selected track:", trackId);
                    
                    if (window.switchToTrackDesktop) {
                        window.switchToTrackDesktop(trackId);
                    }
                }

                // ===== HELPER FUNCTIONS =====
                function createLogTable(tableId) {
                    const table = document.createElement('table');
                    table.id = tableId;
                    table.style.width = '100%';
                    table.style.fontSize = '10px';
                    table.style.fontFamily = 'Courier New, monospace';
                    
                    // Create header
                    const headerRow = table.insertRow();
                    ['Date', 'Topic', 'Message'].forEach(headerText => {
                        const th = document.createElement('th');
                        th.textContent = headerText;
                        th.style.textAlign = 'left';
                        th.style.borderBottom = '1px solid black';
                        headerRow.appendChild(th);
                    });
                    
                    return table;
                }

                function addLogEntryToTable(table, entry) {
                    const row = table.insertRow();
                    
                    // Date cell
                    const dateCell = row.insertCell();
                    dateCell.textContent = entry.date;
                    
                    // Topic cell
                    const topicCell = row.insertCell();
                    topicCell.textContent = entry.topic;
                    topicCell.style.fontWeight = 'bold';
                    
                    // Message cell
                    const messageCell = row.insertCell();
                    messageCell.textContent = entry.message;
                    
                    // Style row
                    row.style.borderBottom = '1px solid #eee';
                }

                function adjustDesktopLogWindowHeight() {
                    const logWindow = document.getElementById('window3');
                    const logContent = document.getElementById('log-book-content');
                    
                    if (logWindow && logContent) {
                        const contentHeight = logContent.scrollHeight + 40;
                        const minHeight = 120;
                        const maxHeight = 400;
                        const newHeight = Math.max(minHeight, Math.min(contentHeight, maxHeight));
                        logWindow.style.height = newHeight + 'px';
                    }
                }

                function addNewLogEntry(date, topic, message, isMobile = false) {
                    const newEntry = { date, topic, message };
                    const tableId = isMobile ? 'mobile-log-table' : 'desktop-log-table';
                    const table = document.getElementById(tableId);
                    
                    if (table) {
                        addLogEntryToTable(table, newEntry);
                        
                        if (!isMobile) {
                            adjustDesktopLogWindowHeight();
                        }
                    }
                }

                // ===== MOBILE VERSION FUNCTIONS =====
                function initMobileLogo() {
                    new p5(function(p) {
                        p.setup = function() {
                            let iconCanvas = p.createCanvas(18, 15);
                            iconCanvas.parent('mobile-logo-icon');
                            p.background(220);
                            p.strokeWeight(2);
                            p.translate(-6, -6);
                            p.rect(6, 6, 18, 15);
                            p.strokeWeight(3);
                            p.line(9, 9, 9, 18);
                            p.line(13, 9, 13, 18);
                            p.line(13, 18, 21, 18);
                            p.line(17, 9, 17, 14);
                            p.line(17, 14, 21, 14);
                            p.line(21, 14, 21, 9);
                        }
                    });
                }

                function initMobileAudioMixer() {
                    new p5(function(p) {
                        // ===== MOBILE MIXER VARIABLES =====
                        const sounds = [
                            'assets/track3/DRUMS.mp3',
                            'assets/track3/BASS.mp3',
                            'assets/track3/GTRS.mp3',
                            'assets/track3/KEYS.mp3',
                            'assets/track3/VOX.mp3',
                            'assets/track3/BVOX.mp3',
                            'assets/track3/ORCH.mp3'
                        ];
                        
                        const names = ['DRUMS', 'BASS', 'GTRS', 'KEYS', 'VOX', 'BVOX', 'ORCH'];
                        let soundObjects = [];
                        const sliderValues = Array(sounds.length).fill(1.0);
                        let isPlaying = false;
                        let filesLoaded = 0;
                        let loadingFailed = false;

                        // ===== PRELOADING =====
                        p.preload = function() {
                            p.getAudioContext();
                            
                            for (let i = 0; i < sounds.length; i++) {
                                try {
                                    const sound = p.loadSound(sounds[i], 
                                        () => { // Success
                                            filesLoaded++;
                                            updateMobileLoadingStatus();
                                        },
                                        (err) => { // Error
                                            console.error("Failed to load sound:", err);
                                            loadingFailed = true;
                                            updateMobileLoadingStatus();
                                        }
                                    );
                                    soundObjects.push(sound);
                                } catch (e) {
                                    console.error("Error loading sound:", e);
                                    loadingFailed = true;
                                    soundObjects.push(null);
                                    updateMobileLoadingStatus();
                                }
                            }
                        };

                        // ===== SETUP =====
                        p.setup = function() {
                            let canvas = p.createCanvas(1, 1);
                            canvas.parent('mobile-volume-sliders');
                            canvas.style('display', 'none');
                            
                            createMobileSliders();
                            setupMobilePlayButton();
                            
                            // Set initial volumes
                            soundObjects.forEach((sound, i) => {
                                if (sound && sound.isLoaded()) {
                                    sound.setVolume(sliderValues[i]);
                                }
                            });
                        };

                        // ===== HELPER FUNCTIONS =====
                        function updateMobileLoadingStatus() {
                            const loadingStatus = document.getElementById('mobile-loading-status');
                            if (loadingFailed) {
                                loadingStatus.innerHTML = '<div style="color: red;">Failed to load some audio files. Check console for details.</div>';
                            } else if (filesLoaded === sounds.length) {
                                loadingStatus.innerHTML = '<div style="color: green;">All audio files loaded successfully!</div>';
                                setTimeout(() => loadingStatus.style.display = "none", 2000);
                            } else {
                                loadingStatus.innerHTML = `
                                    <div>Loading audio files... (${filesLoaded}/${sounds.length})</div>
                                    <div style="color: red; font-size: 9px; margin-top: 3px;">Take mobile device OFF SILENT</div>
                                `;
                            }
                        }

                        function createMobileSliders() {
                            const sliderContainer = document.getElementById('mobile-volume-sliders');
                            sliderContainer.innerHTML = '';
                            
                            for (let i = 0; i < names.length; i++) {
                                const sliderDiv = createMobileSliderElement(i);
                                sliderContainer.appendChild(sliderDiv);
                                setupMobileSliderEvents(sliderDiv, i);
                            }
                        }

                        function createMobileSliderElement(index) {
                            const sliderDiv = document.createElement('div');
                            sliderDiv.className = 'mobile-slider-container';
                            
                            const label = document.createElement('div');
                            label.className = 'mobile-slider-label';
                            label.textContent = names[index];
                            
                            const slider = document.createElement('div');
                            slider.className = 'horizontal-slider';
                            
                            const track = document.createElement('div');
                            track.className = 'horizontal-track';
                            
                            const thumb = document.createElement('div');
                            thumb.className = 'horizontal-thumb';
                            thumb.style.left = '100%'; // Start at full volume
                            thumb.dataset.index = index;
                            
                            // Assemble slider
                            slider.appendChild(track);
                            slider.appendChild(thumb);
                            sliderDiv.appendChild(label);
                            sliderDiv.appendChild(slider);
                            
                            return sliderDiv;
                        }

                        function setupMobileSliderEvents(sliderDiv, index) {
                            const slider = sliderDiv.querySelector('.horizontal-slider');
                            const thumb = sliderDiv.querySelector('.horizontal-thumb');
                            let isDragging = false;

                            // Touch events
                            thumb.addEventListener('touchstart', function(e) {
                                isDragging = true;
                                e.preventDefault();
                            }, { passive: false });

                            slider.addEventListener('touchmove', function(e) {
                                if (!isDragging) return;
                                updateMobileSliderPosition(slider, thumb, index, e.touches[0].clientX);
                                e.preventDefault();
                            }, { passive: false });

                            document.addEventListener('touchend', function() {
                                isDragging = false;
                            });

                            // Mouse events (for testing on desktop)
                            thumb.addEventListener('mousedown', function(e) {
                                isDragging = true;
                                e.preventDefault();
                            });

                            slider.addEventListener('mousemove', function(e) {
                                if (!isDragging) return;
                                updateMobileSliderPosition(slider, thumb, index, e.clientX);
                            });

                            slider.addEventListener('click', function(e) {
                                updateMobileSliderPosition(slider, thumb, index, e.clientX);
                            });

                            document.addEventListener('mouseup', function() {
                                isDragging = false;
                            });
                        }

                        function updateMobileSliderPosition(slider, thumb, index, clientX) {
                            const sliderRect = slider.getBoundingClientRect();
                            let posX = clientX - sliderRect.left;
                            
                            // Constrain position
                            posX = Math.max(0, Math.min(posX, sliderRect.width));
                            
                            // Calculate value and update
                            const value = posX / sliderRect.width;
                            const percent = value * 100;
                            
                            thumb.style.left = `${percent}%`;
                            sliderValues[index] = value;
                            
                            if (soundObjects[index] && soundObjects[index].isLoaded()) {
                                soundObjects[index].setVolume(value);
                            }
                        }

                        function setupMobilePlayButton() {
                            const playButton = document.getElementById('mobile-play-button');
                            
                            playButton.addEventListener('click', () => {
                                if (filesLoaded !== sounds.length) {
                                    alert("Please wait for all audio files to load.");
                                    return;
                                }
                                
                                toggleMobilePlayback();
                            });
                        }

                        function toggleMobilePlayback() {
                            const playButton = document.getElementById('mobile-play-button');
                            
                            if (!isPlaying) {
                                // Start playing
                                soundObjects.forEach(sound => {
                                    if (sound && sound.isLoaded()) {
                                        sound.setVolume(sliderValues[soundObjects.indexOf(sound)]);
                                        if (sound.isPaused()) {
                                            sound.play();
                                        } else {
                                            sound.loop();
                                        }
                                    }
                                });
                                playButton.textContent = "STOP";
                                isPlaying = true;
                            } else {
                                // Stop playing
                                soundObjects.forEach(sound => {
                                    if (sound && sound.isPlaying()) {
                                        sound.pause();
                                    }
                                });
                                playButton.textContent = "PLAY";
                                isPlaying = false;
                            }
                        }

                        // ===== TRACK SWITCHING =====

                            window.switchToTrackMobile = function(newTrackId) {
                                const trackConfig = TRACK_CONFIGS[newTrackId];
                                if (!trackConfig) {
                                    console.error("Track configuration not found:", newTrackId);
                                    return;
                                }
                                
                                console.log("Switching to:", newTrackId);
                                
                                // Stop current playback
                                soundObjects.forEach(sound => {
                                    if (sound && sound.isLoaded()) {
                                        sound.stop();
                                    }
                                });
                                
                                // Reset UI
                                const playButton = document.getElementById('mobile-play-button');
                                playButton.textContent = "PLAY";
                                isPlaying = false;

                                // Reset sliders to default positions  
                                document.querySelectorAll('.horizontal-thumb').forEach((thumb, index) => {
                                    thumb.style.left = '100%'; // Full volume position
                                    sliderValues[index] = 1.0;
                                });
                                
                                // Show loading
                                const loadingStatus = document.getElementById('mobile-loading-status');
                                loadingStatus.style.display = "block";
                                loadingStatus.innerHTML = "Loading track...";
                                
                                // Reset state
                                soundObjects = [];
                                filesLoaded = 0;
                                loadingFailed = false;
                                
                                // Load new track
                                trackConfig.files.forEach((filePath, index) => {
                                    try {
                                        const sound = p.loadSound(filePath,
                                            () => { // Success
                                                filesLoaded++;
                                                loadingStatus.innerHTML = `Loading... (${filesLoaded}/${trackConfig.files.length})`;
                                                sound.setVolume(sliderValues[index]);
                                                
                                                if (filesLoaded === trackConfig.files.length) {
                                                    loadingStatus.innerHTML = "Track loaded!";
                                                    setTimeout(() => loadingStatus.style.display = "none", 1500);
                                                }
                                            },
                                            (err) => { // Error
                                                console.error("Failed to load:", filePath, err);
                                                filesLoaded++;
                                                if (filesLoaded === trackConfig.files.length) {
                                                    loadingStatus.innerHTML = "Track loaded (some files missing)";
                                                    setTimeout(() => loadingStatus.style.display = "none", 2000);
                                                }
                                            }
                                        );
                                        soundObjects[index] = sound;
                                    } catch (e) {
                                        console.error("Error loading sound:", e);
                                        filesLoaded++;
                                    }
                                });
                            };
                    

                        // ===== RESET FUNCTION =====
                        window.resetMobileMixer = function() {
                            // Stop all sounds
                            soundObjects.forEach(sound => {
                                if (sound && sound.isLoaded()) {
                                    sound.stop();
                                }
                            });
                            
                            // Reset UI
                            const playButton = document.getElementById('mobile-play-button');
                            playButton.textContent = "PLAY";
                            isPlaying = false;
                            
                            // Reset sliders
                            document.querySelectorAll('.horizontal-thumb').forEach((thumb, index) => {
                                thumb.style.left = '100%';
                                sliderValues[index] = 1.0;
                                if (soundObjects[index] && soundObjects[index].isLoaded()) {
                                    soundObjects[index].setVolume(1.0);
                                }
                            });
                        };
                    });
                }

                function initMobileSongMenu() {
                    const tracks = [
                        { value: "Track 1: MADRE", enabled: true, trackId: "track1" },
                        { value: "Track 2: PUSH", enabled: true, trackId: "track2" },
                        { value: "Track 3: CHILD", enabled: true, trackId: "track3" },
                        { value: "Track 4", enabled: false, trackId: "track4" },
                        { value: "Track 5", enabled: false, trackId: "track5" }
                    ];

                    // Create menu structure
                    const songMenuContainer = createMobileSongMenuStructure(tracks);
                    
                    // Insert into DOM
                    const mobileWindow = document.getElementById('mobile-window1');
                    const mobileContent = document.getElementById('mobile-content1');
                    mobileWindow.insertBefore(songMenuContainer, mobileContent);
                    
                    setupMobileSongMenuEvents(songMenuContainer);
                }

                function createMobileSongMenuStructure(tracks) {
                    const songMenuContainer = document.createElement('div');
                    songMenuContainer.className = 'mobile-song-menu';
                    
                    // Create button
                    const songButton = document.createElement('div');
                    songButton.className = 'mobile-song-button';
                    songButton.innerHTML = '<span class="track-title">Track 3: CHILD</span><span class="arrow">▼</span>';
                    
                    // Create dropdown
                    const songDropdown = document.createElement('div');
                    songDropdown.className = 'mobile-song-dropdown';
                    
                    // Add tracks
                    tracks.forEach(track => {
                        const trackItem = createMobileTrackItem(track, songButton, songDropdown);
                        songDropdown.appendChild(trackItem);
                    });
                    
                    songMenuContainer.appendChild(songButton);
                    songMenuContainer.appendChild(songDropdown);
                    
                    return songMenuContainer;
                }

                function createMobileTrackItem(track, songButton, songDropdown) {
                    const trackItem = document.createElement('div');
                    trackItem.className = track.enabled ? 'song-item' : 'song-item disabled';
                    trackItem.innerHTML = `<div class="title">${track.value}</div>`;
                    
                    if (!track.enabled) {
                        trackItem.style.color = '#888';
                        trackItem.style.cursor = 'not-allowed';
                    } else {
                        // Add click handler for enabled tracks
                        trackItem.addEventListener('click', () => {
                            updateMobileTrackSelection(songButton, songDropdown, track);
                        });
                    }
                    
                    return trackItem;
                }
                
                function updateMobileTrackSelection(songButton, songDropdown, track) {
                    console.log("Mobile click detected for:", track.value, "trackId:", track.trackId);
                    
                    // Update button text
                    const titleSpan = songButton.querySelector('.track-title');
                    if (titleSpan) {
                        titleSpan.textContent = track.value;
                    }
                    
                    // Close dropdown
                    songDropdown.classList.remove('open');
                    songButton.querySelector('.arrow').style.transform = 'rotate(0deg)';
                    
                    // Switch track using mobile-specific function
                    if (window.switchToTrackMobile && track.trackId) {
                        window.switchToTrackMobile(track.trackId);
                    }
                }

                function setupMobileSongMenuEvents(songMenuContainer) {
                    const songButton = songMenuContainer.querySelector('.mobile-song-button');
                    const songDropdown = songMenuContainer.querySelector('.mobile-song-dropdown');
                    
                    // Toggle dropdown
                    songButton.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const isOpen = songDropdown.classList.toggle('open');
                        const arrow = songButton.querySelector('.arrow');
                        arrow.style.transform = isOpen ? 'rotate(180deg)' : 'rotate(0deg)';
                    });
                    
                    // Close on outside click
                    document.addEventListener('click', (e) => {
                        if (!songMenuContainer.contains(e.target)) {
                            songDropdown.classList.remove('open');
                            songButton.querySelector('.arrow').style.transform = 'rotate(0deg)';
                        }
                    });
                }
                function initMobileOrb() {
                    new p5(function(p) {
                        // ===== MOBILE ORB VARIABLES =====
                        const CONFIG = {
                            orbSize: 200,
                            pixelSize: 4,
                            typingSpeed: 50
                        };

                        const ANSWERS = [
                            "It is certain.",
                            "Ask again later.",
                            "Don't count on it.",
                            "The stars say yes.",
                            "Very doubtful.",
                            "Without a doubt.",
                            "Yes, definitely.",
                            "Better not tell you now.",
                            "My sources say no.",
                            "Outlook good.",
                            "Reply hazy, try again.",
                            "Signs point to yes."
                        ];

                        let orbX, orbY;
                        let dialogueBox;
                        let animationFrame = 0;
                        let currentText = "";
                        let targetText = "";
                        let textIndex = 0;
                        let lastTypedTime = 0;

                        // ===== SETUP =====
                        p.setup = function() {
                            let canvas = p.createCanvas(200, 200);
                            canvas.parent('mobile-orb-canvas-container');
                            
                            orbX = p.width / 2;
                            orbY = p.height / 2;
                            
                            setupMobileDialogueSystem();
                            setMobileDialogue("Ask a question, yes or no, the Orb's wisdom soon will show...");
                        };

                        // ===== DIALOGUE SYSTEM =====
                        function setupMobileDialogueSystem() {
                            dialogueBox = document.getElementById('mobile-dialogue-box');
                            
                            document.getElementById('mobile-ask-button').addEventListener('click', askMobileQuestion);
                            document.getElementById('mobile-question-input').addEventListener('keypress', function(e) {
                                if (e.key === 'Enter') {
                                    askMobileQuestion();
                                }
                            });
                        }

                        function askMobileQuestion() {
                            const questionInput = document.getElementById('mobile-question-input');
                            const question = questionInput.value.trim();
                            
                            if (question) {
                                questionInput.value = '';
                                setMobileDialogue("Hmm, let me think...");
                                
                                setTimeout(() => {
                                    const randomAnswer = ANSWERS[Math.floor(Math.random() * ANSWERS.length)];
                                    setMobileDialogue(randomAnswer);
                                }, 1500);
                            }
                        }

                        function setMobileDialogue(text) {
                            targetText = text;
                            textIndex = 0;
                            currentText = "";
                            lastTypedTime = p.millis();
                        }

                        // ===== DRAWING =====
                        p.draw = function() {
                            p.background(0);
                            animationFrame += 0.01;
                            
                            drawMobileOrb();
                            updateMobileTypingEffect();
                        };

                        function drawMobileOrb() {
                            const radius = CONFIG.orbSize / 2;
                            const centerI = Math.floor((CONFIG.orbSize / CONFIG.pixelSize) / 2);
                            const centerJ = Math.floor((CONFIG.orbSize / CONFIG.pixelSize) / 2);
                            
                            // Draw orb border
                            p.noFill();
                            p.stroke(0);
                            p.strokeWeight(2);
                            p.ellipse(orbX, orbY, CONFIG.orbSize, CONFIG.orbSize);
                            
                            // Draw orb pattern
                            p.noStroke();
                            for (let i = 0; i < CONFIG.orbSize / CONFIG.pixelSize; i++) {
                                for (let j = 0; j < CONFIG.orbSize / CONFIG.pixelSize; j++) {
                                    drawMobileOrbPixel(i, j, centerI, centerJ, radius);
                                }
                            }
                        }

                        function drawMobileOrbPixel(i, j, centerI, centerJ, radius) {
                            const dx = (i - centerI);
                            const dy = (j - centerJ);
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            
                            if (distance < (radius / CONFIG.pixelSize) - 1) {
                                const noiseVal = p.noise(i * 0.1, j * 0.1, animationFrame * 0.5);
                                const brightness = noiseVal > 0.5 ? 255 : 0;
                                
                                p.fill(brightness);
                                p.rect(
                                    orbX - radius + i * CONFIG.pixelSize, 
                                    orbY - radius + j * CONFIG.pixelSize, 
                                    CONFIG.pixelSize, 
                                    CONFIG.pixelSize
                                );
                            }
                        }

                        function updateMobileTypingEffect() {
                            if (textIndex < targetText.length && p.millis() > lastTypedTime + CONFIG.typingSpeed) {
                                currentText += targetText.charAt(textIndex);
                                textIndex++;
                                lastTypedTime = p.millis();
                                dialogueBox.textContent = currentText;
                            }
                        }

                        // ===== RESET FUNCTION =====
                        window.resetMobileOrb = function() {
                            const dialogueBox = document.getElementById('mobile-dialogue-box');
                            dialogueBox.textContent = "Ask a question, yes or no, the Orb's wisdom soon will show...";
                            document.getElementById('mobile-question-input').value = '';
                        };
                    });
                }

                function initMobileUserLog() {
                    const logEntries = [
                        {
                            date: '2025-07-31',
                            topic: 'WELCOME',
                            message: 'You found us.'
                        },
                        {
                            date: '2025-08-23',
                            topic: 'HELLO AGAIN',
                            message: "If you're reading this it means you care because you took the time to check out this site or maybe you're just nosy. Either way take ur time and look around. Ask the orb a question or play around with the mixer. We made this for you."
                        }
                    ];
                    
                    const logBookContent = document.getElementById('mobile-log-book-content');
                    const table = createLogTable('mobile-log-table', true);
                    
                    // Add entries
                    logEntries.forEach(entry => addLogEntryToTable(table, entry));
                    
                    // Update DOM
                    logBookContent.innerHTML = '';
                    logBookContent.appendChild(table);
                }

                function setupMobileWindows() {
                    setupMobileWindowCollapse();
                }

                function setupMobileWindowCollapse() {
                    const mobileCloseBoxes = document.querySelectorAll('.mobile-close-box');
                    
                    mobileCloseBoxes.forEach((closeBox, index) => {
                        // Remove existing listeners to avoid duplicates
                        const newCloseBox = closeBox.cloneNode(true);
                        closeBox.parentNode.replaceChild(newCloseBox, closeBox);
                        
                        // Add new listener
                        newCloseBox.addEventListener('click', () => {
                            toggleMobileWindowContent(index);
                        });
                    });
                }

                function toggleMobileWindowContent(windowIndex) {
                    const contentDiv = document.getElementById(`mobile-content${windowIndex + 1}`);
                    const isCollapsing = !contentDiv.classList.contains('mobile-collapsed');
                    
                    contentDiv.classList.toggle('mobile-collapsed');
                    
                    // Reset functionality when collapsing
                    if (isCollapsing) {
                        switch(windowIndex) {
                            case 0: // Mixer
                                if (window.resetMobileMixer) window.resetMobileMixer();
                                break;
                            case 1: // Orb
                                if (window.resetMobileOrb) window.resetMobileOrb();
                                break;
                            // Cases 2 and 3 (log and gallery) don't need reset
                        }
                    }
                }

                function setupCustomScrollbar() {
                    const contentArea = document.getElementById('mobile-content-area');
                    const scrollThumb = document.getElementById('mobile-scroll-thumb');
                    const scrollUp = document.getElementById('mobile-scroll-up');
                    const scrollDown = document.getElementById('mobile-scroll-down');
                    const scrollTrack = document.querySelector('.mobile-scroll-track');
                    
                    if (!contentArea || !scrollThumb || !scrollTrack) {
                        console.warn('Mobile scrollbar elements not found');
                        return;
                    }
                    
                    setupScrollThumbUpdates(contentArea, scrollThumb, scrollTrack);
                    setupScrollButtons(contentArea, scrollUp, scrollDown);
                    setupScrollThumbDragging(contentArea, scrollThumb, scrollTrack);
                }

                function setupScrollThumbUpdates(contentArea, scrollThumb, scrollTrack) {
                    function updateThumbPosition() {
                        const scrollPercentage = contentArea.scrollTop / (contentArea.scrollHeight - contentArea.clientHeight);
                        const trackHeight = scrollTrack.clientHeight;
                        const thumbHeight = scrollThumb.clientHeight;
                        const maxThumbTop = trackHeight - thumbHeight;
                        const thumbTop = scrollPercentage * maxThumbTop;
                        scrollThumb.style.top = `${thumbTop}px`;
                    }
                    
                    // Update on scroll
                    contentArea.addEventListener('scroll', updateThumbPosition);
                    updateThumbPosition(); // Initial position
                }

                function setupScrollButtons(contentArea, scrollUp, scrollDown) {
                    if (scrollUp) {
                        scrollUp.addEventListener('click', () => {
                            contentArea.scrollBy({
                                top: -100,
                                behavior: 'smooth'
                            });
                        });
                    }
                    
                    if (scrollDown) {
                        scrollDown.addEventListener('click', () => {
                            contentArea.scrollBy({
                                top: 100,
                                behavior: 'smooth'
                            });
                        });
                    }
                }

                function setupScrollThumbDragging(contentArea, scrollThumb, scrollTrack) {
                    let isDragging = false;
                    let startY, startTop;

                    // Mouse events
                    scrollThumb.addEventListener('mousedown', (e) => {
                        isDragging = true;
                        startY = e.clientY;
                        startTop = parseInt(scrollThumb.style.top) || 0;
                        e.preventDefault();
                    });

                    // Touch events
                    scrollThumb.addEventListener('touchstart', (e) => {
                        isDragging = true;
                        startY = e.touches[0].clientY;
                        startTop = parseInt(scrollThumb.style.top) || 0;
                        e.preventDefault();
                    });

                    // Mouse move
                    document.addEventListener('mousemove', (e) => {
                        if (!isDragging) return;
                        updateScrollFromDrag(contentArea, scrollThumb, scrollTrack, e.clientY, startY, startTop);
                    });

                    // Touch move
                    document.addEventListener('touchmove', (e) => {
                        if (!isDragging) return;
                        updateScrollFromDrag(contentArea, scrollThumb, scrollTrack, e.touches[0].clientY, startY, startTop);
                        e.preventDefault();
                    }, { passive: false });

                    // End dragging
                    document.addEventListener('mouseup', () => { isDragging = false; });
                    document.addEventListener('touchend', () => { isDragging = false; });
                }

                function updateScrollFromDrag(contentArea, scrollThumb, scrollTrack, currentY, startY, startTop) {
                    const trackHeight = scrollTrack.clientHeight;
                    const thumbHeight = scrollThumb.clientHeight;
                    const maxThumbTop = trackHeight - thumbHeight;
                    
                    const deltaY = currentY - startY;
                    let newTop = startTop + deltaY;
                    newTop = Math.max(0, Math.min(newTop, maxThumbTop));
                    
                    scrollThumb.style.top = `${newTop}px`;
                    
                    const scrollPercentage = newTop / maxThumbTop;
                    contentArea.scrollTop = scrollPercentage * (contentArea.scrollHeight - contentArea.clientHeight);
                }

                // ===== UTILITY FUNCTIONS =====
                function createLogTable(tableId, isMobile = false) {
                    const table = document.createElement('table');
                    table.id = tableId;
                    table.className = isMobile ? 'mobile-log-table' : '';
                    
                    if (!isMobile) {
                        table.style.width = '100%';
                        table.style.fontSize = '10px';
                        table.style.fontFamily = 'Courier New, monospace';
                    }
                    
                    // Create header
                    const headerRow = table.insertRow();
                    ['Date', 'Topic', 'Message'].forEach(headerText => {
                        const th = document.createElement('th');
                        th.textContent = headerText;
                        if (!isMobile) {
                            th.style.textAlign = 'left';
                            th.style.borderBottom = '1px solid black';
                        }
                        headerRow.appendChild(th);
                    });
                    
                    return table;
                }

                function addLogEntryToTable(table, entry) {
                    const row = table.insertRow();
                    
                    // Create cells
                    const dateCell = row.insertCell();
                    dateCell.textContent = entry.date;
                    
                    const topicCell = row.insertCell();
                    topicCell.textContent = entry.topic;
                    topicCell.style.fontWeight = 'bold';
                    
                    const messageCell = row.insertCell();
                    messageCell.textContent = entry.message;
                    
                    // Style row
                    row.style.borderBottom = '1px solid #eee';
                }

                function adjustDesktopLogWindowHeight() {
                    const logWindow = document.getElementById('window3');
                    const logContent = document.getElementById('log-book-content');
                    
                    if (logWindow && logContent) {
                        const contentHeight = logContent.scrollHeight + 40;
                        const minHeight = 120;
                        const maxHeight = 400;
                        const newHeight = Math.max(minHeight, Math.min(contentHeight, maxHeight));
                        logWindow.style.height = newHeight + 'px';
                    }
                }

                function addNewLogEntry(date, topic, message, isMobile = false) {
                    const newEntry = { date, topic, message };
                    const tableId = isMobile ? 'mobile-log-table' : 'desktop-log-table';
                    const table = document.getElementById(tableId);
                    
                    if (table) {
                        addLogEntryToTable(table, newEntry);
                        
                        if (!isMobile) {
                            adjustDesktopLogWindowHeight();
                        }
                    }
                }

                // ===== INITIALIZE LOG ENTRIES =====
                const welcomeMessage = "If you're reading this it means you care because you took the time to check out this site or maybe you're just nosy. Either way take ur time and look around. Ask the orb a question or play around with the mixer. We made this for you.";
                
                // Add entries to both desktop and mobile logs
                addNewLogEntry('2025-08-23', 'HELLO AGAIN', welcomeMessage, false); // Desktop
                addNewLogEntry('2025-08-23', 'HELLO AGAIN', welcomeMessage, true);  // Mobile

            }); // End of DOMContentLoaded
        </script>
    </body>
</html>
